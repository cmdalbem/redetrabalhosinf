<div class="content">

<div class="container-fluid center">

<h1 class="projectname-text" style="display: inline;"> <%= @project.title %></h1>
<div class="pull-right">
  <% if user_signed_in? and @project.person.user.authorizes?(current_user) %>
    <%= link_to raw("<i class=\"icon-edit\"></i> Editar"), edit_project_path(@project), class: "btn btn-info btn-large" %>
  <% end %>
</div>

<br>
<br>

<div class="row-fluid">

  <% if @project.image? %>
    <div class="">
      <center>
        <%= image_tag @project.image.url %>
      </center>
    </div>
    <br>
    <br>
  <% end %>
</div>

<div class="row-fluid">

  <div class="block span12">

    <h4>Descrição</h4>
    <%= simple_format(@project.description) %>

    <div class="row-fluid">
      <div class="span8">
        <p>
          <ul class="tags clearfix">
          <% @project.tags.each do |tag| %>
            <li> <%= link_to tag.tag_text, "#" %> </li>
          <% end %>
          </ul>
        </p>
      </div>

      <div class="span4">
        <center>
          <p class="curtir-frame"> 
            <span class="" id="project-like-count-<%= @project.id %>"><%= @project.likes.count %></span>
            <i class="icon-thumbs-up"></i>

            <% if user_signed_in? %>
            <%  likeClass = unlikeClass = ""
                if (current_user.person.likes.include?(@project))
                  likeClass = "hidden"
                else
                  unlikeClass = "hidden"
                end %>
                <%= link_to raw(" Curtir"), like_project_path(@project), remote: true, class: likeClass, id: "project-like-action-"+@project.id.to_s %>
                <%= link_to raw(" Curtir (desfazer)"), unlike_project_path(@project), remote: true, class: unlikeClass, id: "project-unlike-action-"+@project.id.to_s %>
            <% end %>
          </p>
        </center>
      </div>
    </div>
  </div>
</div>

<br>

<div class="row-fluid">
  <div class="block span6">
    <p>
      <span class="muted"><i class="icon-user"></i> Autor</span>
      <%= link_to @project.person.nick, profile_path(@project.person.nick) %>
    </p>

    <p>
      <span class="muted"><i class="icon-book"></i> Disciplina</span>
      <%= "#{@project.course.name} (#{@project.semester})"%>
    </p>
    
    <p>
      <span class="muted"><i class="icon-eye-open"></i> Visualizações</span>
      <%= @project.viewCount %>
    </p>

    <p>
      <span class="muted"><i class="icon-time"></i> Adicionado em</span>
      <%= @project.created_at.strftime("%d/%m/%Y") %>
    </p>

  </div>

  <div class="block span6">
    <p>
      <% if @project.link? %>
        <h4><i class="icon-external-link"></i></i> Link</h4>
        <p>
          <%= link_to @project.link, project_link_path(@project) %> <span class="badge"><%=@project.linkHitCount%> hits</span>
        </p>
      <% end %>
    </p>
    <p>
      <% if @project.file? %>
        <h4><i class="icon-file"></i> Arquivo</h4>
        <p>
          <%= link_to "#{@project.file.original_filename} (#{@project.file.size/1024} Kb)", project_download_path(@project) %> <span class="badge"><%=@project.downloadCount%> hits</span>
        </p>
      <% end %>
    </p>        
  </div>
</div>

<br>

<div class="row-fluid">
  <div class="block span12">
    <p>
      <h3><i class="icon-comments"></i> Comentários</h3>
      <% @project.comments.sort_by! {|x| x.created_at} %>
      <ul class="comments-list">
        <% @project.comments.each do |c| %>
          <li id=<%="comment-#{c.id}"%>>
            <header>
              <%= image_tag c.person.avatar.url(:thumb) %>
              <%= link_to c.person.name, profile_path(c.person.nick) %>
              <% if user_signed_in? and current_user.person==c.person %>
                <%= link_to raw("<i class=\"icon-remove\"></i>"), c, confirm: 'Tem certeza?', method: :delete %>
              <% end %>
            </header>
            
            <div class="muted">
              <%= c.created_at %>
            </div>


            <div class="comment">
                <blockquote>
                <%= c.text %>
                </blockquote>
            </div>
          </li>
        <% end %>
        <% if user_signed_in? %>
          <li>
            <header>
              <%= image_tag current_user.person.avatar.url(:thumb) %>
              <%= link_to current_user.person.name, profile_path(current_user.person.nick) %>
            </header>
            <div class="comment">
              <%= form_for(Comment.new) do |f| %>
                <%= f.hidden_field :project_id, value: @project.id %>
                <%= f.hidden_field :person_id, value: current_user.person.id %>
                <div class="field">
                  <%= f.text_area :text, placeholder: "Escreva seu comentário...", rows: 5, style: "width: 50%" %>
                  <br>
                  <%= f.submit "Enviar", class: "btn btn-primary" %>
                </div>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    </p>
  </div>
</div>


</div>
</div>